# Dracut configuration for MiniOS
# Place this file in /etc/dracut.conf.d/90-minios.conf

# Add MiniOS module
add_dracutmodules+=" minios "

# Add essential drivers
add_drivers+=" squashfs overlay aufs loop zram ext4 vfat ntfs ntfs3 exfat fuse "

# Add block device drivers
add_drivers+=" sd_mod usb_storage uas ahci "

# Compression settings
compress="zstd"
compress_level=15

# Omit unnecessary modules to reduce size
omit_dracutmodules+=" plymouth dash resume usrmount i18n "

# Enable parallel build
parallel=yes

# Hostonly mode (set to yes for smaller initramfs specific to current hardware)
# For live systems, this should typically be "no"
hostonly="no"
hostonly_cmdline="no"

# Install network support (uncomment if needed)
# add_dracutmodules+=" network network-manager "

# Install cloud-init support (uncomment if needed)
# add_dracutmodules+=" cloud-init "

# Debug options (uncomment for debugging)
# dracut_install_debug="yes"
# verbosity=4

# Additional kernel modules to include
kernel_modules+=" overlay aufs squashfs loop zram "

# Firmware directories
fw_dir+=" /lib/firmware/updates /lib/firmware "

# Do not strip binaries (uncomment for debugging)
# do_strip=no

# Prefix for kernel modules
# prefix="/"

# Install additional commands
install_items+=" /sbin/blkid /sbin/losetup /usr/bin/lsblk /sbin/parted "

# Early microcode loading
early_microcode=yes

# Use fstab generator
use_fstab=yes

# Persistent policy for device names
persistent_policy="by-uuid"
